#!/bin/sh

# Prompt configuration with git integration.
# (https://zsh.sourceforge.io/Doc/Release/User-Contributions.html#Configuration-1)
# (https://github.com/zsh-users/zsh/blob/master/Misc/vcs_info-examples)
# (https://stevelosh.com/blog/2010/02/my-extravagant-zsh-prompt)

# git:
# %b => current branch
# %a => current action (merge, rebase, or bisect)
# %c => current changed files
# %u => current staged files

# prompt:
# %~ => current path
# %* => time
# %n => username
# %m => shortname host
# %1 => vcs branch and vcs
# %2 => vcs dirty
# %3 => vcs action
# %4 => cmd execution time

# ğŸŒ¹ rose
# ğŸ¥€ wilted_rolse
# ğŸ’ bouquet
# ğŸŒ¼ blossom
# ğŸ’® white_flower
# ğŸŒ· tulip
# ğŸŒº hisbiscus
# ğŸŒ» sunflower
# ğŸŒ¸ sakura
# ğŸ’  diamond
# â˜… black star
# ï„£ star_half_o f123
# â˜† white star
# ïŸ· vintage

# nerd icons
# ï¡ mdi-git f7a1
# îœ¥ git_branch e725
# ï§€source_fork f9c0
# ï¬¬ source_merge fb2c
# ï³º vanish

autoload -Uz vcs_info
autoload -U colors && colors

# hook that runs before every prompt
precmd_vcs_info() { vcs_info }
precmd_functions+=( precmd_vcs_info )

# enable substition in PROMPT
setopt PROMPT_SUBST

_tail() {
  # print -P '%F{30}%B'
}

_head() {
  # print -P '%b%f'
}

zstyle ':vcs_info:*' enable git
zstyle ':vcs_info:*' get-revision true
zstyle ':vcs_info:*' check-for-changes true
zstyle ':vcs_info:*' stagedstr '+'
#zstyle ':vcs_info:*' unstagedstr 'Â±'
zstyle ':vcs_info:*' formats " %b%u%c"
zstyle ':vcs_info:*' actionformats " [%b|%a]%u%c"
zstyle ':vcs_info:git*+set-message:*' hooks git-unstaged

#zstyle ':vcs_info:*' headbehindstr 'â‡£'
#zstyle ':vcs_info:*' headaheadstr 'â‡¡'

+vi-git-unstaged() {
  _gstatus=$(git status --porcelain 2> /dev/null)
  if [ "${_gstatus%% *}" = '??' ]; then
    hook_com[unstaged]+='Â±' # unstaged files in repo
  fi
}

PROMPT='ğŸŒ¸ %F{108}%B%2~%b%f$vcs_info_msg_0_ ğŸ¦‹ '
